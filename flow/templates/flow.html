{% extends "base.html" %}
{% block content %}
<style>
    .table {
        background: transparent;
    }

    .icon {
        height: 20px;
    }

    th,
    td {
        border: 2px solid black;
    }

    thead {
        background-color: #222230;
    }
    #submit{
        background: transparent;
        border: 0;
        color: white;
    }
</style>
<div class="table-responsive-xl">
    <button class="btn btn-outline-light mb-3" id="merge">Merge</button> (beta)
    <table class="table table-dark table-hover" id="tbl">
        <thead class="text-center">
            <tr>
                <th scope="col" style="width: 9%;">เวลา</th>
                <th scope="col" style="width: 15%;">กิจกรรม</th>
                <th scope="col" style="width: 7%;">เวลาเริ่ม</th>
                <th scope="col" style="width: 25%">รายละเอียด</th>
                <th scope="col" style="width: 7%;">ฝ่าย</th>
                <th scope="col" style="width: 7%;">สถานที่</th>
                <th scope="col" style="width: 15%;">หมายเหตุ</th>
                <th scope="col" style="width: 5%;"></th>
            </tr>
        </thead>
        <tbody>
            <tr id="table-row">
                <td class="text-center">4:30 - 5:00</td>
                <td class="text-center">สถานที่ตื่น</td>
                <td class="text-center">4:30</td>
                <td>สถานที่แสตนด์บาย</td>
                <td class="text-center">สถานที่</td>
                <td class="text-center">คณะ</td>
                <td>ภาระกิจส่วนตัว + ถึงคณะ</td>
                <td class="text-center">
                    <span data-toggle="modal" data-target="#modal_view" onclick="" style="cursor:pointer;">
                        <a class="material-tooltip-main" data-toggle="tooltip" data-placement="top" title="View">
                            <i class="fas fa-edit fa-sm"></i>
                        </a>
                    </span>
                    <span data-toggle="modal" data-target="#modal_view" onclick="" style="cursor:pointer;">
                        <a class="material-tooltip-main" data-toggle="tooltip" data-placement="top" title="Delete">
                            <i class="fas fa-times fa-sm"></i>
                        </a>
                    </span>
                </td>
            </tr>
            <tr id="table-row">
                <td class="text-center">4:30 - 5:00</td>
                <td class="text-center">สถานที่ตื่น</td>
                <td class="text-center">4:30</td>
                <td>สถานที่แสตนด์บาย</td>
                <td class="text-center">สถานที่</td>
                <td class="text-center">คณะ</td>
                <td>ภาระกิจส่วนตัว + ถึงคณะ</td>
                <th scope="col">+</th>
            </tr>
            <tr id="table-row">
                <td class="text-center">5:00 - 6:00</td>
                <td class="text-center">สถานที่ตื่น</td>
                <td class="text-center">4:30</td>
                <td>สถานที่แสตนด์บาย</td>
                <td class="text-center">สถานที่</td>
                <td class="text-center">คณะ</td>
                <td>ภาระกิจส่วนตัว + ถึงคณะ</td>
                <th scope="col">+</th>
            </tr>
            <tr id="table-row">
                <td class="text-center">5:00 - 6:00</td>
                <td class="text-center">สถานที่ตื่น</td>
                <td class="text-center">4:30</td>
                <td>สถานที่แสตนด์บาย</td>
                <td class="text-center">สถานที่</td>
                <td class="text-center">คณะ</td>
                <td>ภาระกิจส่วนตัว + ถึงคณะ</td>
                <th scope="col">+</th>
            </tr>
            <tr id="table-row">
                <td class="text-center">7:00 - 8:00</td>
                <td class="text-center">สถานที่ตื่น</td>
                <td class="text-center">4:30</td>
                <td>สถานที่แสตนด์บาย</td>
                <td class="text-center">สถานที่</td>
                <td class="text-center">คณะ</td>
                <td>ภาระกิจส่วนตัว + ถึงคณะ</td>
                <th scope="col">+</th>
            </tr>
            <tr id="table-row">
                <td class="text-center">9:00 - 10:00</td>
                <td class="text-center">สถานที่ตื่น</td>
                <td class="text-center">4:30</td>
                <td>สถานที่แสตนด์บาย</td>
                <td class="text-center">สถานที่</td>
                <td class="text-center">คณะ</td>
                <td>ภาระกิจส่วนตัว + ถึงคณะ</td>
                <th scope="col">+</th>
            </tr>
        </tbody>
    </table>
    <form method="POST" id="flow">
        <table class="table table-dark table-hover" id="tbl">
            {% csrf_token %}
            <thead class="text-center">
                <tr id="table-row">
                    <th scope="col" style="width: 9%;"><input type="text" class="form-control" name="time"></th>
                    <th scope="col" style="width: 15%;"><input type="text" class="form-control" name="activity"></th>
                    <th scope="col" style="width: 7%;"><input type="text" class="form-control" name="sub_time"></th>
                    <th scope="col" style="width: 25%"><input type="text" class="form-control" name="desc"></th>
                    <th scope="col" style="width: 7%;"><input type="text" class="form-control" name="department"></th>
                    <th scope="col" style="width: 7%;"><input type="text" class="form-control" name="location"></th>
                    <th scope="col" style="width: 15%;"><input type="text" class="form-control" name="note"></th>
                    <th scope="col" style="width: 5%; ">
                        <span data-toggle="modal" data-target="#modal_view">
                            <button class="material-tooltip-main" data-toggle="tooltip" data-placement="top" title="Add" id="submit">
                                <i class="far fa-plus-square fa-lg"></i>
                            </button>
                        </span>
                    </th>
                </tr>
            </thead>
        </table>
    </form>
</div>
<script>
    $("#submit").click(function () {
        document.getElementById("flow").submit();
    });
    $("#merge").click(function () {
        var lenghth_col = document.getElementById('tbl').rows[0].cells.length - 1;
        var lenghth_row = document.getElementById('tbl').rows.length - 2
        for (let i = lenghth_col; i >= 0; i--) {
            var first = '', last = '';
            var row = 1;
            $('table > tbody > tr').each(function (index, tr) {
                last = tr.children[i];
                if (first == '') {
                    console.log('if', first.innerHTML, last.innerHTML, index, 1)
                    first = last;
                }
                else if (index == lenghth_row) {
                    console.log('end', first.innerHTML, last.innerHTML, index, 1)
                    if (first.innerHTML == last.innerHTML) {
                        last.remove();
                        row++;
                        first.setAttribute('rowspan', row);
                    }
                }
                else if (first.innerHTML == last.innerHTML) {
                    console.log('else if', first.innerHTML, last.innerHTML, index, 1)
                    last.remove();
                    row++;
                }
                else {
                    console.log('else', first.innerHTML, last.innerHTML)
                    first.setAttribute('rowspan', row);
                    first = last;
                    row = 1
                }
            })
        }
    });
</script>

{% endblock %}